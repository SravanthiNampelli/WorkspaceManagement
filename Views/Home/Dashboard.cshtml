@using PagedList.Mvc
@model PagedList.IPagedList<SpaceIQ.Employee>
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "Dashboard";
    WebGrid webGrid = new WebGrid(source: Model, canSort: false, canPage: false);

}


@*Searchbox*@
@using (Html.BeginForm(FormMethod.Get))
{
    @Html.AntiForgeryToken()
    if (User.IsInRole("Admin"))
    {
        <div class="d-flex justify-content-center align-content-center mt-5">
            <h2>Admin Dashboard</h2>
        </div>
    }
    else
    {
        <div class="d-flex justify-content-center align-content-center mt-5">
            <h2>Employee Dashboard</h2>
        </div>

    }
    <div class="input-group d-flex justify-content-start align-content-start   ">
        @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @class = "form-control rounded", @placeholder = "Search by employee name" })
        <button type="submit" class="btn btn-primary" style="background-color:black">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
            </svg>
        </button>
    </div>
    <br />
}

@if (User.IsInRole("Admin"))
{
    <div class="row">
        <div class="col-md-6">
            <p><b>Note : </b>Sort the table by clicking on the column headings below</p>
        </div>
        <div class="col-md-6 d-flex justify-content-end align-content-end">
            @using (Html.BeginForm("Export", "Export", FormMethod.Post))
            {

                <button class="btn btn-dark" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-csv" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM3.517 14.841a1.13 1.13 0 0 0 .401.823c.13.108.289.192.478.252.19.061.411.091.665.091.338 0 .624-.053.859-.158.236-.105.416-.252.539-.44.125-.189.187-.408.187-.656 0-.224-.045-.41-.134-.56a1.001 1.001 0 0 0-.375-.357 2.027 2.027 0 0 0-.566-.21l-.621-.144a.97.97 0 0 1-.404-.176.37.37 0 0 1-.144-.299c0-.156.062-.284.185-.384.125-.101.296-.152.512-.152.143 0 .266.023.37.068a.624.624 0 0 1 .246.181.56.56 0 0 1 .12.258h.75a1.092 1.092 0 0 0-.2-.566 1.21 1.21 0 0 0-.5-.41 1.813 1.813 0 0 0-.78-.152c-.293 0-.551.05-.776.15-.225.099-.4.24-.527.421-.127.182-.19.395-.19.639 0 .201.04.376.122.524.082.149.2.27.352.367.152.095.332.167.539.213l.618.144c.207.049.361.113.463.193a.387.387 0 0 1 .152.326.505.505 0 0 1-.085.29.559.559 0 0 1-.255.193c-.111.047-.249.07-.413.07-.117 0-.223-.013-.32-.04a.838.838 0 0 1-.248-.115.578.578 0 0 1-.255-.384h-.765ZM.806 13.693c0-.248.034-.46.102-.633a.868.868 0 0 1 .302-.399.814.814 0 0 1 .475-.137c.15 0 .283.032.398.097a.7.7 0 0 1 .272.26.85.85 0 0 1 .12.381h.765v-.072a1.33 1.33 0 0 0-.466-.964 1.441 1.441 0 0 0-.489-.272 1.838 1.838 0 0 0-.606-.097c-.356 0-.66.074-.911.223-.25.148-.44.359-.572.632-.13.274-.196.6-.196.979v.498c0 .379.064.704.193.976.131.271.322.48.572.626.25.145.554.217.914.217.293 0 .554-.055.785-.164.23-.11.414-.26.55-.454a1.27 1.27 0 0 0 .226-.674v-.076h-.764a.799.799 0 0 1-.118.363.7.7 0 0 1-.272.25.874.874 0 0 1-.401.087.845.845 0 0 1-.478-.132.833.833 0 0 1-.299-.392 1.699 1.699 0 0 1-.102-.627v-.495Zm8.239 2.238h-.953l-1.338-3.999h.917l.896 3.138h.038l.888-3.138h.879l-1.327 4Z" />
                    </svg> Export to CSV
                </button>
            }
        </div>
    </div>
}
else
{

    <div class="row">
        <div class="col-md-6">
            <p><b>Note : </b>Sort the table by clicking on the column headings below</p>
        </div>
    </div>

}
<div class="d-flex justify-content-end align-content-end">

</div>

<div></div>

@*No data found*@
@if (ViewData["NoDataFound"] != null)
{
    <div style="color:red; font-size:25px" class="d-flex justify-content-center align-content-center">
        @ViewData["NoDataFound"]
    </div>
}
else
{
    <table class="table" border="1">
        @*Table headings*@
        <thead>
            <tr>
                <th>
                    @Html.ActionLink("Employee Id", "Dashboard", new { sortOrder = ViewBag.IdSortParam, currentFilter = ViewBag.CurrentFilter }, new { style = "text-decoration:none; " })
                </th>
                <th>
                    @Html.ActionLink("Employee Name", "Dashboard", new { sortOrder = ViewBag.NameSortParam, currentFilter = ViewBag.CurrentFilter }, new { style = "text-decoration:none; " })
                </th>
                <th>
                    @Html.ActionLink("Workspace Number", "Dashboard", new { sortOrder = ViewBag.WorkspaceIdSortParam, currentFilter = ViewBag.CurrentFilter }, new { style = "text-decoration:none; " })
                </th>
            </tr>
        </thead>

        <tbody class="align-content-md-center">
            @foreach (var employee in Model)
            {
                //yet to assign a workspace
                if (employee.Workspace == null)
                {
                    <tr>
                        <td style="background-color: #FFB6C1 ">@employee.EmpId</td>
                        <td style="background-color: #FFB6C1 ">@employee.EmpName</td>
                        <td style="background-color: #FFB6C1 "> Not yet assigned </td>
                        <td style="background-color: #FFB6C1 ">
                            @if (User.IsInRole("Admin"))
                            {
                                <button class="btn " style="color: white; background-color: black " onclick="window.location.href='@Url.Action("Assign", "Home")?EmpId=@employee.EmpId'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0" />
                                    </svg>

                                </button>
                            }
                        </td>
                    </tr>
                }
                //workspace assigned already
                else
                {

                    <tr>
                        <td style="background-color: #428bca">@employee.EmpId</td>
                        <td style="background-color: #428bca ">@employee.EmpName</td>
                        <td align="left" style="background-color: #428bca ">@employee.Workspace.WorkspaceNumber </td>
                        <td style="background-color: #428bca ">
                            @if (User.IsInRole("Admin"))
                            {
                                <button class="btn " style="color: white; background-color: black " onclick="window.location.href='@Url.Action("Edit", "Home")?EmpId=@employee.EmpId'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
                                        <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z" />
                                    </svg>
                                </button>
                            }
                        </td>
                    </tr>
                }

            }
        </tbody>
    </table>
}

<div class="fixed-bottom d-flex justify-content-center align-content-center">
    @Html.PagedListPager(Model, page => Url.Action("Dashboard",
        new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter }))
</div>






